{% extends 'confined.html' %}
{% import 'macros.html' as macros %}

{% block addons %}
{% endblock %}

{% import 'macros.html' as macros %}

{% block title %}
  BugDiary - {{project.name}} - All Bugs
{% endblock %}

{% block custom_nav %}
{{ macros.project_nav(project) }}
{% endblock %}


{% block main %}
<h1>{{ project.name }} - Cards View</h1>
<div class="cards-flex">
    <div class="card">
      <h2>Filters</h2>
      <!-- <p>
        Click on a label (little round rectangle) to show all issues with the same label, or enter a filter criterion below to filter.
      </p> -->
      <form action="{{ url_for('projects.cards_view', project_url = project.url) }}" method = "get" autocomplete="off">
        <label for="searchterm">Filter Term</label>
        <input name="searchterm" id="searchterm" type="text" placeholder="Enter filter value">
        <label name="searchtype" id="searchtype" for="searchtype">Filter Type</label>
        <select name="searchtype" id="searchtype">
          <option value="version">Version Number</option>
          <option value="location">Location</option>
          <option value="type">Type</option>
        </select>
        <input id="showResolved" name="showResolved" type="checkbox" {% if request.args.get('showResolved') %}checked{%endif%}><label for="showResolved">Show Resolved</label> <br>
        <input id="showDeleted" name="showDeleted" type="checkbox" {% if request.args.get('showDeleted') %}checked{%endif%}><label for="showDeleted">Show Deleted</label> <br>
        <input type="submit" value="Filter" class="button-primary">
      </form>
      <a href="{{ url_for('projects.cards_view', project_url = project.url) }}">
        <button type="button" class="button-styled">Reset Filters</button>
      </a>
      <a href="{{ url_for('projects.dashboard', project_url = project.url) }}" class="navigation">Go Back</a>
    </div>
    {% for bug in bug_list %}
      {{ macros.bugcard(bug, True) }}
    {% endfor %}
</div>

<div class="hidden">
  <form method="post" autocomplete="off">
    {{ form.hidden_tag() }}
    {{ form.submit() }}
  </form>
</div>
{{ macros.ad("medium")}}
<script>


  function fill_card_form(button_id, action) {
      var instructions = {
          card: button_id,
          action: action
      };
  
  
      fetch(`{{ url_for('projects.manage_card') }}`, {
          method: "POST",
          credentials: "include",
          body: JSON.stringify(instructions),
          cache: "no-cache",
          headers: new Headers({
              "content-type": "application/json"
          })
      })
      .then(function(response) {
      if (response.status !== 200) {
          alert(`Looks like there was a problem. Status code: ${response.status}`);
          return;
      }
      response.json().then(function(data) {
          target_card = document.getElementById('card-' + button_id);
          
          target_card.innerHTML = data['result'];
          // target_card.innerHTML = "#" + button_id + " has been processed. Please refresh the page to see the change.";
      });
      })
      .catch(function(error) {
          alert("Fetch error: " + error);
      });
  }
  
  </script>

{% endblock %}
