{% extends 'confined.html' %}
{% import 'macros.html' as macros %}

{% block addons %}
{% endblock %}

{% block title %}
    BugDiary - {{title}} - Bug Locations and Types
{% endblock %}

{% block custom_nav %}
{{ macros.project_nav(project) }}
{% endblock %}

{% block main %}

<h1>Possible Locations and Types</h1>
<p class="border-left-accent">
    This is the final step! Help your users/testers describe the bugs they report by listing some possible types (i.e. typos, grammar, suggestions) and locations (i.e. homepage, contact page, url). A preview is available below. Click on the "Done" button below when you're ready to move on.
    <br><a href="{{ url_for('projects.dashboard', project_url = url) }}" class="button-primary rounded shadowed">All Done</a>
</p>
<!-- <p class="border-left-accent">
    Users/testers can manually enter a value that's not listed here.
</p> -->


<div class="block-comparison-2">
    <div class="comp1 rounded shadowed bg-white block">
        <h3>Locations</h3>
        <div class="loc_and_type_container">
            {% for loc in bug_locations %}
            <div id="loc-{{loc.id}}">{{ loc['location'] }} {% if loc['location'] != "None" %}<span>Delete</span>{% endif %}</div>
            {% endfor %}
        </div>
        <div class="spacer-small"></div>
        <form method="post" action="">
            <label for="new_location">New Location</label>
            <input name="new_location" type="text"/>
            <input type="submit" class="button-primary" value="Add Location"/>
        </form>
    </div>
    <div class="comp2 rounded shadowed bg-white block">
        <h3>Types</h3>
        <div class="loc_and_type_container">
            {% for bug_type in bug_types %}
            <div id="type-{{ bug_type['id']}}">{{bug_type['type']}} {% if bug_type['type'] != "None" %}<span>Delete</span>{% endif %}</div>
            {% endfor %}
        </div>
        <div class="spacer-small"></div>
        <form method="post" action="">
            <label for="new_type">New Type</label>
            <input name="new_type" type="text"/>
            <input type="submit" class="button-primary" value="Add Type"/>
        </form>
    </div>
</div>

<div class="block rounded bg-gray">
    <h3>Preview</h3>
    <p>The following is what your testers/users will see when they report a bug.</p>
    <div class="bg-white rounded shadowed block" id="preview">
        <h3>Reporting a Bug</h3>

        {% if form_type == "suggest" %}
            <label>Bug Location</label>
            <input type="text" list="location_list">
            <datalist id="location_list">
                {% for loc in bug_locations %}
                <option value="{{ loc['location'] }}">{{ loc['location'] }}</option>
                {% endfor %}
            </datalist>

            <label>Bug Type</label>
            <input type="text" list="type_list">
            <datalist id="type_list">
                {% for bug_type in bug_types %}
                <option value="{{ bug_type['type'] }}">{{ bug_type['type'] }}</option>
                {% endfor %}
            </datalist>
        {% elif form_type == "select" %}
            <label>Bug Location (select)</label>
            <select>
                {% for loc in bug_locations %}
                <option value="{{ loc['location'] }}">{{ loc['location'] }}</option>
                {% endfor %}
            </select>

            <label>Bug Type (select)</label>
            <select>
                {% for bug_type in bug_types %}
                <option value="{{ bug_type['type'] }}">{{ bug_type['type'] }}</option>
                {% endfor %}
            </select>
        {% endif %}
        <label>Description</label>
        <textarea></textarea>
        <p>
            <a onClick="toggleElement('form-contact')">(Optional) Click to Provide Contact Details</a>
        </p>
        <div id="form-contact" class="hidden block lined rounded">
            <label>Name</label>
            <input type="text">
            <label>Email</label>
            <input type="text" placeholder="(Optional)">
        </div>
        <button type="button" class="button-secondary button-styled">Submit Report</button>
    </div>
</div>


<script>


    function fill_card_form(button_id, action) {
        var instructions = {
            card: button_id,
            action: action,
            format: "card"
        };
    
    
        fetch(`{{ url_for('projects.manage_card') }}`, {
            method: "POST",
            credentials: "include",
            body: JSON.stringify(instructions),
            cache: "no-cache",
            headers: new Headers({
                "content-type": "application/json"
            })
        })
        .then(function(response) {
        if (response.status !== 200) {
            alert(`Looks like there was a problem. Status code: ${response.status}`);
            return;
        }
        response.json().then(function(data) {
            target_card = document.getElementById('card-' + button_id);
            
            target_card.innerHTML = data['result'];
            // target_card.innerHTML = "#" + button_id + " has been processed. Please refresh the page to see the change.";
        });
        })
        .catch(function(error) {
            alert("Fetch error: " + error);
        });
    }
    
    </script>
{% endblock %}
